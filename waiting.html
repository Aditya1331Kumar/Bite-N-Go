<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Status ‚Äî Waiting</title>
  <link rel="stylesheet" href="waiting/wait.css">
</head>
<body>
  <!-- Entire page background is decorative; visible content restricted to the centered .panel -->
  <div class="page-bg" aria-hidden="true"></div>

  <main class="center-root" role="main" aria-labelledby="panelTitle">
    <section class="panel" id="statusPanel" aria-live="polite" tabindex="0">
      <div class="panel-inner">
        <header class="panel-header">
          <h1 id="panelTitle" class="panel-title">Order Pending</h1>
          <p class="panel-sub">Your order is being processed ‚Äî please wait while we confirm payment & availability.</p>
        </header>

        <div class="panel-body">
          <div class="status-visual">
            <!-- decorative plate / clock / food elements -->
            <div class="plate">
              <svg class="plate-svg" viewBox="0 0 120 120" aria-hidden="true" focusable="false">
                <defs>
                  <radialGradient id="g1" cx="50%" cy="40%" r="60%">
                    <stop offset="0%" stop-color="#fff"/>
                    <stop offset="100%" stop-color="#fff0"/>
                  </radialGradient>
                </defs>
                <circle cx="60" cy="60" r="46" fill="url(#g1)" stroke="#f3f4f6" stroke-width="2"/>
                <circle cx="60" cy="60" r="36" fill="#fff" stroke="#f0f0f0" stroke-width="1.4"/>
              </svg>
              <div class="plate-center" aria-hidden="true">
                <div class="clock-emoji">‚è≥</div>
              </div>
            </div>
          </div>

          <div class="status-copy">
            <div class="estimation-line">
              <div class="estimation-title">Please wait ‚Äî confirmation in</div>
              <div id="countdown" class="countdown" aria-atomic="true">02:00:00</div>
            </div>

            <p class="details">
              Our team will call you within <strong>2 hours</strong> to confirm delivery details and payment.
              Please keep your phone reachable. If we can't reach you, try calling 8809499019
            </p>

            <div class="cta-row">
              <a id="callBtn" class="btn call" href="tel:+919876543210" aria-label="Call support at +91 98765 43210">üìû Call Now</a>
              <a id="reportBtn" class="btn report" href="tel:+919876543210" aria-label="Report an issue">‚ö†Ô∏è Report an issue</a>
            </div>

            <div class="support-note">
              <p>If you face any inconvenience, call us or tap <button id="requestCallBtn" class="link-like" type="button">Request a call-back</button>.</p>
            </div>
          </div>
        </div>

        <footer class="panel-footer">
          <div class="footer-left">Order ID: <span id="orderId">ORD-<span id="shortId">--</span></span></div>
          <div class="footer-right">Estimated staff call time: <span id="callWindow">Within 2 hours</span></div>
        </footer>
      </div>
    </section>
  </main>

  <!-- hidden ARIA live region for announcements -->
  <div id="announcer" class="sr-only" aria-live="assertive" aria-atomic="true"></div>

  <!-- Scripts: countdown, localStorage order id, CTA behaviors, accessibility -->
  <script>
    (function(){
      // Configuration
      const SUPPORT_NUMBER = '+919876543210';
      const COUNTDOWN_SECONDS = 2 * 60 * 60; // 2 hours

      // DOM refs
      const countdownEl = document.getElementById('countdown');
      const orderIdEl = document.getElementById('shortId');
      const callBtn = document.getElementById('callBtn');
      const reportBtn = document.getElementById('reportBtn');
      const requestCallBtn = document.getElementById('requestCallBtn');
      const announcer = document.getElementById('announcer');
      const statusPanel = document.getElementById('statusPanel');

      // Place order id in footer - generate or reuse from localStorage
      const ORDER_KEY = 'raj_wait_order';
      function ensureOrderId(){
        const existing = localStorage.getItem(ORDER_KEY);
        if(existing){
          try{
            const obj = JSON.parse(existing);
            if(obj && obj.id){
              return obj;
            }
          } catch(e){}
        }
        const newObj = {
          id: 'ORD-' + Date.now().toString(36).toUpperCase().slice(-8),
          createdAt: Date.now(),
          countdownStart: Date.now()
        };
        localStorage.setItem(ORDER_KEY, JSON.stringify(newObj));
        return newObj;
      }

      const orderObj = ensureOrderId();
      orderIdEl.textContent = orderObj.id.slice(-6);

      // Countdown persistence: we store start timestamp on first visit
      function getRemainingSeconds(){
        const saved = JSON.parse(localStorage.getItem(ORDER_KEY) || '{}');
        const start = saved.countdownStart || Date.now();
        const elapsed = Math.floor((Date.now() - start) / 1000);
        const remaining = Math.max(0, COUNTDOWN_SECONDS - elapsed);
        return remaining;
      }

      // Format seconds to HH:MM:SS
      function formatHMS(s){
        const hh = Math.floor(s/3600).toString().padStart(2,'0');
        const mm = Math.floor((s%3600)/60).toString().padStart(2,'0');
        const ss = Math.floor(s%60).toString().padStart(2,'0');
        return hh + ':' + mm + ':' + ss;
      }

      // Update UI every second
      let remaining = getRemainingSeconds();
      countdownEl.textContent = formatHMS(remaining);

      const tick = () => {
        if(remaining <= 0){
          countdownEl.textContent = '00:00:00';
          announcer.textContent = 'Your order confirmation window has passed. Our staff will call shortly.';
          // change panel style to "ready" visually
          statusPanel.classList.add('ready');
          // optionally change call button style to emphasize
          callBtn.classList.add('urgent');
          return;
        }
        remaining--;
        countdownEl.textContent = formatHMS(remaining);
      };
      const intervalId = setInterval(tick, 1000);
      // run immediate tick after 1s handled above; also ensure if it reaches zero stop interval
      // we'll not clear interval to allow UI to reflect ready state; but could clear if desired

      // CTA behaviors: call buttons use tel: links; request call triggers local action (simulated)
      callBtn.href = 'tel:' + SUPPORT_NUMBER;
      reportBtn.href = 'tel:' + SUPPORT_NUMBER;

      requestCallBtn.addEventListener('click', () => {
        // Simulate a callback request: store in localStorage and show toast and announce
        const callbacks = JSON.parse(localStorage.getItem('raj_callback_requests') || '[]');
        const req = { id: 'CB-' + Date.now().toString(36).toUpperCase().slice(-6), time: new Date().toISOString() };
        callbacks.push(req);
        localStorage.setItem('raj_callback_requests', JSON.stringify(callbacks));
        showToast('Call-back requested. Our team will call you soon.');
        announcer.textContent = 'Call-back requested. Our team will call you soon.';
      });

      // Small toast helper
      function showToast(msg, life=3200){
        const t = document.createElement('div');
        t.className = 'toast ok';
        t.textContent = msg;
        document.body.appendChild(t);
        // position and remove after time
        setTimeout(()=> t.style.opacity = '0', life - 300);
        setTimeout(()=> t.remove(), life);
      }

      // Accessibility: focus panel on load
      window.addEventListener('load', () => {
        statusPanel.focus({preventScroll:true});
      });

      // Hover lift effect adds class (CSS handles transform)
      statusPanel.addEventListener('mouseenter', () => statusPanel.classList.add('hovered'));
      statusPanel.addEventListener('mouseleave', () => statusPanel.classList.remove('hovered'));

      // For debug in console
      window.__RAJ_WAIT__ = { order: orderObj, remaining };

    })();
  </script>
</body>
</html>
